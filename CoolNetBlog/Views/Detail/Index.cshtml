@model HomeViewModel
@{
    // 此局部视图Detail/Index/，是文章详细局部视图，文章详细视图模型与主页分页一样，直接继承自视图模型HomeViewModel，
    if (Model?.DetailArticleData == null)
    {
        <div class="alert alert-warning" role="alert">
         @Model?.NotTips
        </div>
    }
    else
    {
        if (@Model.DetailArticleData.IsShowTitle)
        {
            <h4>@Model?.DetailArticleData.Title</h4>
        }
        if (!String.IsNullOrWhiteSpace(@Model?.DetailArticleData.Labels))
        {
            <figure class="text-end">
            <blockquote class="blockquote">
            <p>
            <small>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-award" viewBox="0 0 16 16">
              <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68L9.669.864zm1.196 1.193.684 1.365 1.086 1.072L12.387 6l.248 1.506-1.086 1.072-.684 1.365-1.51.229L8 10.874l-1.355-.702-1.51-.229-.684-1.365-1.086-1.072L3.614 6l-.25-1.506 1.087-1.072.684-1.365 1.51-.229L8 1.126l1.356.702 1.509.229z"/>
              <path d="M4 11.794V16l4-1 4 1v-4.206l-2.018.306L8 13.126 6.018 12.1 4 11.794z"/>
            </svg>
            @foreach (var item in @Model.DetailArticleData.LabelsList)
            {
                // 让标签成为关键字搜索
                <mark>·<a class="text-dark" asp-action="Index" asp-controller="Home" asp-route-from="keyword" asp-route-kw="@item">@(item)</a></mark>
            }
            </small>
            </p>
            </blockquote>
            </figure>

        }
        if (@Model.DetailArticleData.IsLock)
        {
            <div id="lockFormDiv">
                <div>
                    <div class="alert alert-dark" role="alert">这篇文章已被上锁，你需要输入专属密码才能阅读。</div>
                    <div hidden class="alert alert-warning" role="alert" id="pwErrorTipDiv">验证错误，尝试重输或者返回看看别的吧？！</div>
                    <input hidden type="number" class="form-control" id="inputArticleId" value="@Model.DetailArticleData.Id">
                    <div class="input-group mb-3">
                    <input type="text" class="form-control input-group-sm" id="inputPassword" placeholder="专属密码" aria-label="Recipient's username" aria-describedby="button-addon2">
                    <button class="btn btn-outline-primary" type="button" id="toUnlockBtn">解锁</button>
                    </div>
                </div>
            </div>
            <div class="text-start">
            <p id="unLockContentP" class="text-start"></p>
            </div>

        }else
        {
            <div class="text-start">
            <p>@Html.Raw(@Model?.DetailArticleData.Content)</p>
            </div>
        }
  
        <div>
        <small>
        <span class="badge rounded-pill bg-success">来自：@Model?.DetailArticleData.Ig_MenuName</span>
        <br/>
        <span class="badge rounded-pill bg-info text-dark">更新于@(Model?.DetailArticleData.UpdateTime.ToString("yyyy-MM-dd HH:mm:ss"))</span>
        <br/>
        <span class="badge rounded-pill bg-info text-dark">发表于@(Model?.DetailArticleData.CreatedTime.ToString("yyyy-MM-dd HH:mm:ss"))</span>
        </small>
        </div>
        
        <div>
        <br/>
        <small>
        <button type="button" class="btn btn-sm position-relative"><svg t="1645800787151" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5453" width="25" height="25"><path d="M786.501 833.386l-5.686-37.883 51.059-98.45-14.579-27.326 44.128-104.773-12.042-21.509 45.723-113.362c-1.867-4.875-9.241-10.05-17.008-10.05l-1.142-0.038L582.84 400.72l-0.445-15.895c-2.138-76.36-11.697-185.078-69.781-247.327-24.309-26.052-48.021-39.823-68.574-39.823-12.801 0-22.073 5.273-27.115 9.098 0.184 35.379-0.849 178.84-27.882 277.572l-2.187 8.739L332 412.947V900h398.557c9.314 0 23.073-12.135 36.804-32.623 9.055-13.51 15.932-27.183 19.14-33.991z" fill="#FFC0C0" p-id="5454"></path><path d="M930 432.35c0-12.889-6.075-25.474-17.083-34.525-9.659-7.942-22.052-12.554-34.306-12.708l-261.915-17.17c-3.319-80.713-16.592-187.838-78.58-254.272-31.527-33.788-63.174-50.92-94.091-50.92-36.239 0-57.092 24.122-57.963 25.149l-4.245 5.013 0.113 6.571c0.027 1.637 2.37 160.553-24.291 266.94l-32.255 11.793c-8.37-14.53-24.362-24.221-42.685-24.221h-138.81C116.932 354 95 374.988 95 401.175v511.228C95 938.404 116.932 960 143.889 960h138.81c18.426 0 34.498-10 42.829-25h405.029c22.338 0 44.579-16.308 66.108-48.584 14.355-21.52 23.534-42.752 23.918-43.646l1.958-4.55-5.511-36.704 54.302-104.697-15.401-28.862 44.298-105.173-12.442-21.796L930 435.738v-3.388zM730.557 900H332V412.947l54.856-19.861 2.29-8.739c27.033-98.732 28.015-242.193 27.83-277.572 5.042-3.826 14.288-9.098 27.089-9.098 20.553 0 44.252 13.77 68.561 39.823 58.084 62.249 67.636 170.967 69.774 247.327l0.442 15.895 294.114 19.275 1.141 0.038c7.767 0 15.14 5.175 17.007 10.05l-45.723 113.362 12.041 21.509-44.128 104.773 14.579 27.326-51.059 98.45 5.686 37.883c-3.208 6.808-10.085 20.482-19.14 33.991C753.63 887.865 739.871 900 730.557 900zM130 912.404V401.175c0-6.814 6.317-12.175 13.889-12.175h138.81c7.572 0 14.301 5.361 14.301 12.175v511.228c0 6.746-6.599 12.596-14.301 12.596h-138.81C136.187 925 130 919.149 130 912.404z" fill="" p-id="5455"></path><path d="M282.699 925c7.702 0 14.301-5.851 14.301-12.596V401.175c0-6.814-6.73-12.175-14.301-12.175h-138.81c-7.572 0-13.889 5.361-13.889 12.175v511.228c0 6.746 6.187 12.596 13.889 12.596h138.81z" fill="#E0344C" p-id="5456"></path></svg>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">@Model?.DetailArticleData.ThumbUpStart<span class="visually-hidden"></span></span>
        </button>
        <button class="btn btn-outline-primary btn-sm" id="thumbUpBtn" onclick="thumbUpBtnClick(@Model?.DetailArticleData.Id)" data-bs-placement="bottom" tabindex="0" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-content="">点个赞ᶘᵒᴥᵒᶅ↗</button>
        </small>
        </div>

        <br/>

        <div>
        <button onClick="javascript:history.back(-1);" type="button" class="btn btn-outline-primary btn-sm">回到之前</button>
        </div>
        <br/>
    }
}

<script>
$("#toUnlockBtn").click(
    function()
    {
        var v = $('#inputPassword').val();
        if(v==null||v==""){
            return;
        }
        $.ajax (
            {
                url: "/Detail/ArticleUnLock",
                type: "POST",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({
                    "ArticleId":$('#inputArticleId').val(),
                    "Password":$('#inputPassword').val()
                }),
                success: function(data, status){
                    if(data['code']==1){
                        // 密码正确隐藏表单div 显示返回后的主体内容
                        $('#lockFormDiv').hide();
                        $('#unLockContentP').html(data['content']);
                    }else{
                        // 错误显示提示文本
                        $('#pwErrorTipDiv').removeAttr('hidden');
                    }
                },
                error: function(err){
                    $('#pwErrorTipDiv').removeAttr('hidden');
                }
            }
        );
    }
);

//文章点赞按钮点击
function thumbUpBtnClick(id){
    $('#thumbUpBtn').attr("disabled", "true");
    $.ajax (
        {
            url: "/ThumbsUp/ThumbsUp",
            type: "POST",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            data: {
                "ArticleId":id,
            },
            success: function(data, status){
                if(data['code']==1){
                    // 点赞成功 将点赞数重显 
                    $('#thumbUpStartEle').text(data['data'])
                }
                // bootstrap显示按钮弹出层 作为提示
                $('#thumbUpBtn').attr('data-bs-content', data['tipMessage']);
                var popover = new bootstrap.Popover($('#thumbUpBtn'), {trigger: 'focus'});
                popover.show();
                setTimeout(function(){popover.hide();}, 2500);
            },
            error: function(err){
                $('#thumbUpBtn').attr('data-bs-content', "点赞失败，好意心领啦err。");
                var popover = new bootstrap.Popover($('#thumbUpBtn'), {trigger: 'focus'});
                popover.show();
                setTimeout(function(){popover.hide();}, 2500);
            }
        }
    );
    
}
function HideThumpUpTipBtn(){
    // 3秒后 bootstrap隐藏按钮弹出层 无论如何 执行此代码
    
}
</script>


